version: "1"

services:
  # üåê Dashboard (web): PRD
  - type: web
    name: messiahbot-dashboard
    env: python
    plan: starter
    autoDeploy: true
    branch: main
    buildCommand: pip install -r requirements.txt
    startCommand: gunicorn "web.dashboard_messiah:app" --bind 0.0.0.0:$PORT
    healthCheckPath: /ping
    envVars:
      - fromGroup: messiahbot-core
      - key: PORT
        value: 10000
      - key: ENVIRONMENT
        value: PRD

  # ü§ñ Bot worker: PRD
  - type: worker
    name: messiahbot-worker
    env: python
    plan: starter
    autoDeploy: true
    branch: main
    buildCommand: pip install -r requirements.txt
    startCommand: python -m bot.messiahbot_dc
    envVars:
      - fromGroup: messiahbot-core
      - key: ENVIRONMENT
        value: PRD

  # üìÖ Twitch/Discord schedule sync worker: PRD
  - type: worker
    name: messiahbot-twitch-sync
    env: python
    plan: starter
    autoDeploy: true
    branch: main
    buildCommand: pip install -r requirements.txt
    startCommand: python -m bot.workers.twitch_sync_worker
    envVars:
      - fromGroup: messiahbot-core
      - key: ENVIRONMENT
        value: PRD

  # üåê Dashboard (web): TST
  - type: web
    name: messiahbot-dashboard-tst
    env: python
    plan: starter
    autoDeploy: true
    branch: main
    buildCommand: pip install -r requirements.txt
    startCommand: gunicorn "web.dashboard_messiah:app" --bind 0.0.0.0:$PORT
    healthCheckPath: /ping
    envVars:
      - fromGroup: messiahbot-core
      - key: PORT
        value: 10000
      - key: ENVIRONMENT
        value: TST

  # ü§ñ Bot worker: TST
  - type: worker
    name: messiahbot-worker-tst
    env: python
    plan: starter
    autoDeploy: true
    branch: main
    buildCommand: pip install -r requirements.txt
    startCommand: python -m bot.messiahbot_dc
    envVars:
      - fromGroup: messiahbot-core
      - key: ENVIRONMENT
        value: TST

  # üìÖ Twitch/Discord schedule sync worker: TST
  # - type: worker
    # name: messiahbot-twitch-sync-tst
    # env: python
    # plan: starter
    # autoDeploy: true
    # branch: main
    # buildCommand: pip install -r requirements.txt
    # startCommand: python -m bot.workers.twitch_sync_worker
    # envVars:
      # - fromGroup: messiahbot-core
      # - key: ENVIRONMENT
        # value: TST 