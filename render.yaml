version: "1"

services:
  # üåê Dashboard (web): PRD
  - type: web
    name: messiahbot-dashboard
    env: python
    plan: starter
    autoDeploy: true
    branch: main
    buildCommand: pip install -r requirements.txt
    startCommand: gunicorn "web.dashboard_messiah:app" --bind 0.0.0.0:$PORT
    healthCheckPath: /ping
    envVars:
      - fromGroup: messiahbot-core
      - key: PORT
        value: 10000
      - key: ENVIRONMENT
        value: PRD

  # ü§ñ Bot worker: PRD
  - type: service
    name: messiah-bot-worker
    env: python
    plan: starter
    autoDeploy: true
    branch: main
    buildCommand: pip install -r requirements.txt
    startCommand: python -m bot.workers.messiah_bot_worker
    envVars:
      - fromGroup: messiahbot-core
      - key: ENVIRONMENT
        value: PRD

  # Bot: PRD
  - type: worker
    name: messiah-bot
    env: python
    plan: starter
    autoDeploy: true
    branch: main
    buildCommand: pip install -r requirements.txt
    startCommand: python -m bot.messiah_bot
    envVars:
      - fromGroup: messiahbot-core
      - key: ENVIRONMENT
        value: PRD

  # üåê Dashboard (web): TST
  - type: web
    name: messiahbot-dashboard-tst
    env: python
    plan: starter
    autoDeploy: true
    branch: main
    buildCommand: pip install -r requirements.txt
    startCommand: gunicorn "web.dashboard_messiah:app" --bind 0.0.0.0:$PORT
    healthCheckPath: /ping
    envVars:
      - fromGroup: messiahbot-tst
      - key: PORT
        value: 10000
      - key: ENVIRONMENT
        value: TST

  # ü§ñ Bot worker: TST
  - type: service
    name: messiah-bot-worker
    env: python
    plan: starter
    autoDeploy: true
    branch: main
    buildCommand: pip install -r requirements.txt
    startCommand: python -m bot.workers.messiah_bot_worker
    envVars:
      - fromGroup: messiahbot-tst
      - key: ENVIRONMENT
        value: TST

  # Bot
  - type: worker
    name: messiahbot-twitch-sync-tst
    env: python
    plan: starter
    autoDeploy: true
    branch: main
    buildCommand: pip install -r requirements.txt
    startCommand: python -m bot.messiah_bot
    envVars:
      - fromGroup: messiahbot-tst
      - key: ENVIRONMENT
        value: TST 